<!-- Description of the build process:


validate 	
initialize 				-Read domibus.properties from domibus-config/domibus.properties using properties-maven-plugin.
							Those values will be filtered later into the server configuration. 
generate-sources 	
process-sources 	
generate-resources 		-domibus-config is copied to target/domibus-config
						-src/main/modules of the domibus modules are copied to target/${project.build.finalName}/WEB-INF/modules
						-project resources (i.e. persistence.xml) are filtered 


process-resources 	
compile 	
process-classes 	
generate-test-sources 	
process-test-sources 	-test resources (i.e. src/test/resources/META-INF/persistence.xml) are filtered.
generate-test-resources 
process-test-resources 	
test-compile 	
process-test-classes 	
test 					-unit tests not matching *IntegrationTest.java are executed
prepare-package 	
package 	
pre-integration-test 	-read build.properties from domibus-config/build.properties using properties-maven-plugin.
							Values defined here are overriding values defined in domibus.properties for the purpose of integration testing.
						-copy filtered domibus-config to tatget/domibus-integration/config
						-database scripts are generated using hibernate3-maven-plugin. The persistence.xml located in 
							src/test/resources/META-INF is used for this.
						-derby database is started using derby-maven-plugin
						-the generated derby script is imported into the database using sql-maven-plugin
						-tomcat is set up using integration-test-config, packaged and started
						
						
integration-test 		-unit tests matching *IntegrationTest.java are executed
post-integration-test 	-tomcat is shut down
verify 					-if the jenkins profile is activated all configured assemblies are built, using the properties set in domibus.properties
install 	
deploy 					-deployment is made to ecodex-nexus, deployer credentials are required



profiles:

jenkins:
The build server profile. Generates assemblies

debug:
starts the server in debug mode, listening for a debugger on port 8000. Server is stopped with ctrl-c. To suspend the server until a debugger is 
connected start the build with -Ddebug.suspend=y parameter

debug_both: 
starts two tomcat servers in debug mode, listening for a debugger on port 8000 and 9000(integration-test-server). Servers are stopped with ctrl-c.
To suspend the server until a debugger is connected start the build with -Ddebug.suspend=y parameter 

weblogic: like a normal build without profile but instead of tomcats servers two weblogic 11g servers were used for integration tests
 -->


<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">

    <parent>
        <groupId>eu.domibus</groupId>
        <artifactId>domibus</artifactId>
        <version>1.4.1.1-FINAL</version>
        <relativePath>../../pom.xml</relativePath>
    </parent>
    <modelVersion>4.0.0</modelVersion>
    <artifactId>domibus-distribution</artifactId>
    <name>Domibus Distribution</name>
    <packaging>war</packaging>
    <properties>
        <prefix.jndi>java:comp/env/</prefix.jndi>
        <main.basedir>${project.parent.basedir}</main.basedir>
        <gateway.server.dependencies>${project.build.directory}/server/dependencies</gateway.server.dependencies>
        <gateway.server.sending>${project.build.directory}/server/sending</gateway.server.sending>
        <gateway.server.sending.configFolder>${project.parent.basedir}/domibus-config/tomcat/conf
        </gateway.server.sending.configFolder>
        <gateway.server.sending.db.clean>
            ${project.build.directory}/sql/hibernate3/domibus_derby_integration_testing.sql
        </gateway.server.sending.db.clean>
        <gateway.server.sending.db.initial>${project.build.directory}/sql/hibernate3/domibus_derby_initial.sql
        </gateway.server.sending.db.initial>
        <gateway.server.receiving.configFolder>
            ${project.basedir}/src/test/resources/domibus-integration-test-server-config/tomcat/conf
        </gateway.server.receiving.configFolder>
        <gateway.server.receiving>${project.build.directory}/server/receiving</gateway.server.receiving>
        <gateway.server.receiving.db.clean>
            ${project.build.directory}/sql/hibernate3/domibus_derby_integration_testing.sql
        </gateway.server.receiving.db.clean>
        <gateway.server.receiving.db.initial>${project.build.directory}/sql/hibernate3/domibus_derby_initial.sql
        </gateway.server.receiving.db.initial>
        <domibus.testing.default.config.file>${main.basedir}/domibus-config/domibus.properties
        </domibus.testing.default.config.file>
        <domibus.testing.config.file>${domibus.testing.default.config.file}</domibus.testing.config.file>
        <gateway.version.sending>${project.version}</gateway.version.sending>
        <gateway.version.receiving>${project.version}</gateway.version.receiving>
        <surefire.tests.include>**/*IntegrationTest.java</surefire.tests.include>
    </properties>
    <dependencies>
        <dependency>
            <groupId>commons-httpclient</groupId>
            <artifactId>commons-httpclient</artifactId>
            <scope>compile</scope>
        </dependency>
        <dependency>
            <groupId>org.apache.axis2</groupId>
            <artifactId>axis2-jaxws</artifactId>
            <scope>compile</scope>
        </dependency>
        <dependency>
            <groupId>org.apache.axis2</groupId>
            <artifactId>axis2-saaj</artifactId>
            <scope>compile</scope>
        </dependency>
        <dependency>
            <groupId>org.apache.axis2</groupId>
            <artifactId>axis2-transport-http</artifactId>
            <scope>compile</scope>
        </dependency>
        <dependency>
            <groupId>org.hibernate</groupId>
            <artifactId>hibernate-entitymanager</artifactId>
            <scope>compile</scope>
        </dependency>
        <dependency>
            <groupId>org.hibernate</groupId>
            <artifactId>hibernate-c3p0</artifactId>
            <scope>compile</scope>
        </dependency>  
        <dependency>
            <groupId>org.hibernate</groupId>
            <artifactId>hibernate-core</artifactId>
            <scope>compile</scope>
        </dependency>
  
        <dependency>
            <groupId>org.opensymphony.quartz</groupId>
            <artifactId>quartz</artifactId>
            <scope>compile</scope>
        </dependency>
        <dependency>
            <groupId>log4j</groupId>
            <artifactId>log4j</artifactId>
            <scope>compile</scope>
        </dependency>
        <dependency>
            <groupId>org.apache.axis2</groupId>
            <artifactId>axis2</artifactId>
            <scope>compile</scope>
        </dependency>
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring</artifactId>
            <scope>compile</scope>
        </dependency>
        
        <dependency>
            <groupId>org.apache.activemq</groupId>
            <artifactId>activemq-all</artifactId>
            <scope>compile</scope>
        </dependency>
        <dependency>
            <groupId>org.simpleframework</groupId>
            <artifactId>simple-xml</artifactId>
            <scope>compile</scope>
        </dependency>
        <dependency>
            <groupId>org.apache.neethi</groupId>
            <artifactId>neethi</artifactId>
            <scope>compile</scope>
        </dependency>
        <dependency>
            <groupId>org.apache.rampart</groupId>
            <artifactId>rampart-dist</artifactId>
            <type>pom</type>
            <scope>compile</scope>
        </dependency>
        <dependency>
            <artifactId>xercesImpl</artifactId>
            <groupId>xerces</groupId>
            <version>2.10.0</version>
        </dependency>
        <dependency>
            <groupId>org.jdom</groupId>
            <artifactId>jdom</artifactId>
            <scope>compile</scope>
        </dependency>
        <dependency>
            <groupId>org.eclipse.persistence</groupId>
            <artifactId>javax.persistence</artifactId>
            <scope>compile</scope>
        </dependency>
        <dependency>
            <groupId>org.apache.ws.commons.axiom</groupId>
            <artifactId>axiom-api</artifactId>
            <scope>compile</scope>
        </dependency>
        <dependency>
            <groupId>commons-io</groupId>
            <artifactId>commons-io</artifactId>
            <scope>compile</scope>
        </dependency>
        <dependency>
            <groupId>org.apache.ws.commons.axiom</groupId>
            <artifactId>axiom-dom</artifactId>
            <scope>compile</scope>
        </dependency>
        <dependency>
            <groupId>org.apache.axis2</groupId>
            <artifactId>axis2-transport-local</artifactId>
            <scope>compile</scope>
        </dependency>
        <dependency>
            <groupId>eu.domibus</groupId>
            <artifactId>domibus-common</artifactId>
            <scope>compile</scope>
        </dependency>
        <dependency>
            <groupId>eu.domibus</groupId>
            <artifactId>domibus-logging</artifactId>
            <scope>compile</scope>
        </dependency>
        <dependency>
            <groupId>eu.domibus</groupId>
            <artifactId>domibus-ebms3</artifactId>
            <scope>compile</scope>
        </dependency>
        <dependency>
            <groupId>eu.domibus</groupId>
            <artifactId>domibus-security</artifactId>
            <scope>compile</scope>
        </dependency>
        <dependency>
            <groupId>eu.domibus</groupId>
            <artifactId>domibus-backend</artifactId>
            <scope>compile</scope>
        </dependency>
        <!-- Development -->
 
<!--   <dependency> -->
<!--             <groupId>org.apache.ibatis</groupId> -->
<!--             <artifactId>ibatis-sqlmap</artifactId> -->
<!--             <version>2.3.4.726</version> -->
<!--               <scope>test</scope> -->
<!--         </dependency> -->
<!--         <dependency> -->
<!--             <groupId>org.apache.derby</groupId> -->
<!--             <artifactId>derby</artifactId> -->
<!--             <version>10.10.1.1</version> -->
<!--               <scope>test</scope> -->
<!--         </dependency> -->
<!--         <dependency> -->
<!--             <groupId>org.apache.derby</groupId> -->
<!--             <artifactId>derbynet</artifactId> -->
<!--             <version>10.10.1.1</version> -->
<!--               <scope>test</scope> -->
<!--         </dependency> -->
<!--         <dependency> -->
<!--             <groupId>org.apache.derby</groupId> -->
<!--             <artifactId>derbyclient</artifactId> -->
<!--             <version>10.10.1.1</version> -->
<!--               <scope>test</scope> -->
<!--         </dependency> -->
<!--         <dependency> -->
<!--             <groupId>org.codehaus.cargo</groupId> -->
<!--             <artifactId>cargo-core-container-tomcat</artifactId> -->
<!--             <version>1.4.5</version> -->
<!--               <scope>test</scope> -->
<!--         </dependency> -->
        <dependency>
            <groupId>eu.domibus</groupId>
            <artifactId>domibus-seatiger</artifactId>
            <version>1.4-FINAL</version>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>com.smartbear.soapui</groupId>
            <artifactId>soapui</artifactId>
            <version>4.6.2</version>
            <exclusions>
                <!-- These are mainly GUI artifacts not needed in the headless test runner-->
                <exclusion>
                    <groupId>teamdev</groupId>
                    <artifactId>jxbrowser</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>teamdev</groupId>
                    <artifactId>comfyj</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>teamdev</groupId>
                    <artifactId>winpack</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>teamdev</groupId>
                    <artifactId>xulrunner-windows</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>teamdev</groupId>
                    <artifactId>xulrunner-linux64</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>teamdev</groupId>
                    <artifactId>xulrunner-linux</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>teamdev</groupId>
                    <artifactId>xulrunner-mac</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>teamdev</groupId>
                    <artifactId>MozillaInterfaces</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>teamdev</groupId>
                    <artifactId>engine-gecko</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>teamdev</groupId>
                    <artifactId>engine-gecko15</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>teamdev</groupId>
                    <artifactId>engine-ie</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>teamdev</groupId>
                    <artifactId>engine-webkit</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>teamdev</groupId>
                    <artifactId>jniwrap</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>teamdev</groupId>
                    <artifactId>xulrunner15-mac</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>teamdev</groupId>
                    <artifactId>xulrunner15-windows</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>com.jgoodies</groupId>
                    <artifactId>forms</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>com.jgoodies</groupId>
                    <artifactId>looks</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>com.jgoodies</groupId>
                    <artifactId>binding</artifactId>
                </exclusion>
            </exclusions>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>org.apache.httpcomponents</groupId>
            <artifactId>httpcore</artifactId>
            <version>4.2.4</version>
            <scope>test</scope>
        </dependency>
    </dependencies>
    <profiles>
        <profile>
            <id>testNewOld</id>
            <activation>
                <activeByDefault>false</activeByDefault>
            </activation>
            <properties>
                <gateway.version.sending>${project.version}</gateway.version.sending>
                <gateway.version.receiving>1.3</gateway.version.receiving>
                <gateway.server.receiving.configFolder>
                    ${project.basedir}/src/test/resources/domibus-integration-test-v1-3_server-config_receiving/tomcat/conf
                </gateway.server.receiving.configFolder>
                <gateway.server.receiving.db.clean>
                    ${project.basedir}/src/test/resources/domibus-integration-test-v1-3_server-config_receiving/db-script/domibus_derby_integration_testing.sql
                </gateway.server.receiving.db.clean>
                <gateway.server.receiving.db.initial>
                    ${project.basedir}/src/test/resources/domibus-integration-test-v1-3_server-config_receiving/db-script/domibus_derby_initial.sql
                </gateway.server.receiving.db.initial>
            </properties>
        </profile>

        <profile>
            <id>testOldOld</id>
            <activation>
                <activeByDefault>false</activeByDefault>
            </activation>
            <properties>
                <gateway.version.sending>1.3</gateway.version.sending>
                <gateway.version.receiving>1.3</gateway.version.receiving>
                <gateway.server.receiving.configFolder>
                    ${project.basedir}/src/test/resources/domibus-integration-test-v1-3_server-config_receiving/tomcat/conf
                </gateway.server.receiving.configFolder>
                <gateway.server.receiving.db.clean>
                    ${project.basedir}/src/test/resources/domibus-integration-test-v1-3_server-config_receiving/db-script/domibus_derby_integration_testing.sql
                </gateway.server.receiving.db.clean>
                <gateway.server.receiving.db.initial>
                    ${project.basedir}/src/test/resources/domibus-integration-test-v1-3_server-config_receiving/db-script/domibus_derby_initial.sql
                </gateway.server.receiving.db.initial>
                <gateway.server.sending.configFolder>
                    ${project.basedir}/src/test/resources/domibus-integration-test-v1-3_server-config_sending/tomcat/conf
                </gateway.server.sending.configFolder>
                <gateway.server.sending.db.clean>
                    ${project.basedir}/src/test/resources/domibus-integration-test-v1-3_server-config_sending/db-script/domibus_derby_integration_testing.sql
                </gateway.server.sending.db.clean>
                <gateway.server.sending.db.initial>
                    ${project.basedir}/src/test/resources/domibus-integration-test-v1-3_server-config_sending/db-script/domibus_derby_initial.sql
                </gateway.server.sending.db.initial>
            </properties>
        </profile>
        <profile>
            <id>testOldNew</id>
            <activation>
                <activeByDefault>false</activeByDefault>
            </activation>
            <properties>
                <gateway.server.sending.configFolder>
                    ${project.basedir}/src/test/resources/domibus-integration-test-v1-3_server-config_sending/tomcat/conf
                </gateway.server.sending.configFolder>
                <gateway.server.sending.db.clean>
                    ${project.basedir}/src/test/resources/domibus-integration-test-v1-3_server-config_sending/db-script/domibus_derby_integration_testing.sql
                </gateway.server.sending.db.clean>
                <gateway.server.sending.db.initial>
                    ${project.basedir}/src/test/resources/domibus-integration-test-v1-3_server-config_sending/db-script/domibus_derby_initial.sql
                </gateway.server.sending.db.initial>
                <gateway.version.sending>1.3</gateway.version.sending>
                <gateway.version.receiving>${project.version}</gateway.version.receiving>
            </properties>
        </profile>
        <profile>
            <id>debug_both</id>
            <activation>
                <activeByDefault>false</activeByDefault>
            </activation>
            <properties>
                <surefire.tests.include>eu/ecodex/integrationTests/util/DebugBoth.java</surefire.tests.include>
            </properties>
        </profile>
        <profile>
            <id>jenkins</id>
            <properties>
                <domibus.testing.config.file>${main.basedir}/domibus-config/build.properties
                </domibus.testing.config.file>
            </properties>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-source-plugin</artifactId>
                    </plugin>
                    <plugin>
                        <artifactId>maven-antrun-plugin</artifactId>
                        <version>1.7</version>
                        <executions>
                            <execution>
                                <phase>verify</phase>
                                <configuration>
                                    <target>
                                        <replace file="${project.build.directory}/artifacts/tomcat/conf/server.xml"
                                                 token='Host appBase="webapps" autoDeploy="true" name="localhost"'
                                                 value='Host appBase="webapps" autoDeploy="false" name="localhost"'/>
                                    </target>
                                </configuration>
                                <goals>
                                    <goal>run</goal>
                                </goals>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-assembly-plugin</artifactId>
                        <configuration>
                            <descriptors>
                                <descriptor>src/main/assembly/tomcat-full.xml</descriptor>
                                <descriptor>src/main/assembly/tomcat-configuration-only.xml</descriptor>
                                <descriptor>src/main/assembly/sql-scripts.xml</descriptor>
                                <descriptor>src/main/assembly/war-with-configfiles.xml</descriptor>
                            </descriptors>
                        </configuration>
                        <executions>
                            <execution>
                                <id>make-assembly</id>
                                <!-- bound to verify because we need to execute cargo-package first
                                    which is in post-integration-test -->
                                <phase>verify</phase>
                                <goals>
                                    <goal>single</goal>
                                </goals>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>
    </profiles>
    <build>
        <finalName>domibus</finalName>
        <resources>
            <resource>
                <directory>src/main/resources</directory>
                <filtering>true</filtering>
            </resource>
        </resources>
        <testResources>
            <testResource>
                <directory>src/test/resources</directory>
                <filtering>true</filtering>
            </testResource>
        </testResources>
        <plugins>
            <plugin>
                <groupId>org.codehaus.mojo</groupId>
                <artifactId>properties-maven-plugin</artifactId>
                <version>1.0-alpha-2</version>
                <executions>
                    <execution>
                        <id>read-build-properties</id>
                        <phase>initialize</phase>
                        <goals>
                            <goal>read-project-properties</goal>
                        </goals>
                        <configuration>
                            <files>
                                <file>${main.basedir}/domibus-config/domibus.properties</file>
                                <file>${domibus.testing.config.file}</file>
                            </files>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-resources-plugin</artifactId>
                <configuration>
                    <useDefaultDelimiters>false</useDefaultDelimiters>
                    <delimiters>
                        <delimiter>@*@</delimiter>
                    </delimiters>
                    <nonFilteredFileExtensions>
                        <nonFilteredFileExtensions>jks</nonFilteredFileExtensions>
                        <nonFilteredFileExtensions>mar</nonFilteredFileExtensions>
                        <nonFilteredFileExtensions>aar</nonFilteredFileExtensions>
                        <nonFilteredFileExtensions>sql</nonFilteredFileExtensions>
                        <nonFilteredFileExtensions>ddl</nonFilteredFileExtensions>
                    </nonFilteredFileExtensions>
                    <encoding>UTF-8</encoding>
                </configuration>
                <executions>
                    <execution>
                        <id>copy-modules</id>
                        <phase>generate-resources</phase>
                        <goals>
                            <goal>copy-resources</goal>
                        </goals>
                        <configuration>
                            <outputDirectory>${project.build.directory}/${project.build.finalName}/WEB-INF/modules
                            </outputDirectory>
                            <resources>
                                <resource>
                                    <directory>../domibus-backend/src/main/modules</directory>
                                    <includes>
                                        <include>**/*</include>
                                    </includes>
                                    <filtering>true</filtering>
                                </resource>
                                <resource>
                                    <directory>../domibus-ebms3/src/main/modules</directory>
                                    <includes>
                                        <include>**/*</include>
                                    </includes>
                                    <filtering>true</filtering>
                                </resource>
                                <resource>
                                    <directory>../domibus-security/src/main/modules</directory>
                                    <includes>
                                        <include>**/*</include>
                                    </includes>
                                    <filtering>true</filtering>
                                </resource>
                                <resource>
                                    <directory>../domibus-logging/src/main/modules</directory>
                                    <includes>
                                        <include>**/*</include>
                                    </includes>
                                    <filtering>true</filtering>
                                </resource>
                            </resources>
                        </configuration>
                    </execution>

                </executions>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-dependency-plugin</artifactId>
                <version>2.6</version>
                <executions>
                    <execution>
                        <id>download-domibus</id>
                        <phase>pre-integration-test</phase>
                        <goals>
                            <goal>copy</goal>
                        </goals>
                        <configuration>
                            <artifactItems>
                                <artifactItem>
                                    <groupId>eu.domibus</groupId>
                                    <artifactId>domibus-distribution</artifactId>
                                    <version>${gateway.version.sending}</version>
                                    <type>war</type>
                                    <outputDirectory>${gateway.server.sending}</outputDirectory>
                                    <destFileName>domibus.war</destFileName>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>eu.domibus</groupId>
                                    <artifactId>domibus-distribution</artifactId>
                                    <version>${gateway.version.receiving}</version>
                                    <type>war</type>
                                    <outputDirectory>${gateway.server.receiving}</outputDirectory>
                                    <destFileName>domibus.war</destFileName>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>org.apache.derby</groupId>
                                    <artifactId>derbyclient</artifactId>
                                    <version>10.10.1.1</version>
                                    <type>jar</type>
                                    <outputDirectory>${gateway.server.dependencies}</outputDirectory>
                                </artifactItem>
                            </artifactItems>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-war-plugin</artifactId>
                <version>2.3</version>
                <configuration>
                    <nonFilteredFileExtensions>
                        <nonFilteredFileExtension>mar</nonFilteredFileExtension>
                        <nonFilteredFileExtension>aar</nonFilteredFileExtension>
                    </nonFilteredFileExtensions>
                    <recompressZippedFiles>false</recompressZippedFiles>
                    <webResources>
                        <resource>
                            <directory>src/main/webapp</directory>
                            <filtering>true</filtering>
                        </resource>
                    </webResources>
                </configuration>
            </plugin>
            <plugin>
                <groupId>org.codehaus.mojo</groupId>
                <artifactId>hibernate3-maven-plugin</artifactId>
                <version>3.0</version>
                <configuration>
                    <hibernatetool>
                        <classpath>
                            <path location="${project.build.directory}/test-classes/"/>
                        </classpath>
                        <jpaconfiguration persistenceunit="generatePU"/>
                        <hbm2ddl create="true" export="false" drop="true"
                                 outputfilename="configuration.sql" format="true" console="true"/>
                    </hibernatetool>
                </configuration>
                <dependencies>
                    <!-- We are using the hibernate3 plugin and thus need the old hibernate3
                        dependencies -->
                    <dependency>
                        <groupId>org.hibernate.javax.persistence</groupId>
                        <artifactId>hibernate-jpa-2.0-api</artifactId>
                        <version>1.0.0.Final</version>
                    </dependency>
                    <dependency>
                        <groupId>org.hibernate</groupId>
                        <artifactId>hibernate-tools</artifactId>
                        <version>3.2.4.GA</version>
                    </dependency>
                    <dependency>
                        <groupId>org.hibernate</groupId>
                        <artifactId>hibernate-entitymanager</artifactId>
                        <version>3.6.10.Final</version>
                    </dependency>
                    <dependency>
                        <groupId>org.hibernate</groupId>
                        <artifactId>hibernate-core</artifactId>
                        <version>3.6.10.Final</version>
                    </dependency>
                    <dependency>
                        <groupId>log4j</groupId>
                        <artifactId>log4j</artifactId>
                        <version>1.2.14</version>
                    </dependency>
                    <dependency>
                        <groupId>commons-logging</groupId>
                        <artifactId>commons-logging</artifactId>
                        <version>1.1.1</version>
                    </dependency>
                </dependencies>
                <executions>
                    <execution>
                        <id>generate-derby-sql</id>
                        <phase>pre-integration-test</phase>
                        <goals>
                            <goal>run</goal>
                        </goals>
                        <configuration>
                            <hibernatetool>
                                <jpaconfiguration persistenceunit="generateDerbyPU"/>
                                <hbm2ddl create="true" export="false" drop="false"
                                         outputfilename="domibus_derby_initial.sql" format="true"
                                         console="false"/>
                            </hibernatetool>
                        </configuration>
                    </execution>
                    <execution>
                        <id>generate-derby-testing-sql</id>
                        <phase>pre-integration-test</phase>
                        <goals>
                            <goal>run</goal>
                        </goals>
                        <configuration>
                            <hibernatetool>
                                <jpaconfiguration persistenceunit="generateDerbyPU"/>
                                <hbm2ddl create="true" export="false" drop="true"
                                         outputfilename="domibus_derby_integration_testing.sql" format="true"
                                         console="false"/>
                            </hibernatetool>
                        </configuration>
                    </execution>
                    <execution>
                        <id>generate-mysql-sql</id>
                        <phase>pre-integration-test</phase>
                        <goals>
                            <goal>run</goal>
                        </goals>
                        <configuration>
                            <hibernatetool>
                                <jpaconfiguration persistenceunit="generateMySqlPU"/>
                                <hbm2ddl create="true" export="false" drop="false"
                                         outputfilename="domibus_mysql_initial.sql" format="true"
                                         console="false"/>
                            </hibernatetool>
                        </configuration>
                    </execution>
                    <execution>
                        <id>generate-oracle-sql</id>
                        <phase>pre-integration-test</phase>
                        <goals>
                            <goal>run</goal>
                        </goals>
                        <configuration>
                            <hibernatetool>
                                <jpaconfiguration persistenceunit="generateOraclePU"/>
                                <hbm2ddl create="true" export="false" drop="false"
                                         outputfilename="domibus_oracle_initial.sql" format="true"
                                         console="false"/>
                            </hibernatetool>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
            <!-- This is the configuration for the sending server which will be used
                for packaging -->
            <plugin>
                <groupId>org.codehaus.cargo</groupId>
                <artifactId>cargo-maven2-plugin</artifactId>
                <version>1.4.0</version>
                <configuration>
                    <container>
                        <containerId>tomcat6x</containerId>
                    </container>
                    <configuration>
                        <configfiles>
                            <configfile>
                                <file>${main.basedir}/domibus-config/tomcat/conf</file>
                                <todir>conf</todir>
                            </configfile>
                            <configfile>
                                <file>${main.basedir}/domibus-config/store</file>
                                <todir>store</todir>
                            </configfile>
                        </configfiles>
                        <propertiesFile>${main.basedir}/domibus-config/domibus.properties</propertiesFile>
                        <properties>
                            <!--suppress MavenModelInspection -->
                            <cargo.servlet.port>${domibus.module.ebms3.MSH.pt}</cargo.servlet.port>
                            <!--suppress MavenModelInspection -->
                            <cargo.rmi.port>${tomcat.rmi.pt}</cargo.rmi.port>
                            <!--suppress MavenModelInspection -->
                            <cargo.tomcat.ajp.port>${tomcat.ajp.pt}</cargo.tomcat.ajp.port>
                        </properties>
                    </configuration>
                </configuration>
                <executions>
                    <execution>
                        <id>configure-packaging-server</id>
                        <phase>post-integration-test</phase>
                        <goals>
                            <goal>configure</goal>
                        </goals>
                    </execution>
                    <execution>
                        <id>package-server</id>
                        <phase>post-integration-test</phase>
                        <goals>
                            <goal>package</goal>
                        </goals>
                        <configuration>
                            <container>
                                <containerId>tomcat6x</containerId>
                            </container>
                            <packager>
                                <outputLocation>${project.build.directory}/artifacts/tomcat</outputLocation>
                            </packager>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-surefire-plugin</artifactId>
                <configuration>
                    <testFailureIgnore>false</testFailureIgnore>
                </configuration>
                <executions>
                    <execution>
                        <phase>integration-test</phase>
                        <goals>
                            <goal>test</goal>
                        </goals>
                        <configuration>
                            <excludes>
                                <exclude>none</exclude>
                            </excludes>
                            <includes>
                                <include>${surefire.tests.include}</include>
                            </includes>
                            <systemPropertyVariables>
                                <gateway.deployable.sending>${gateway.server.sending}/domibus.war
                                </gateway.deployable.sending>
                                <gateway.deployable.receiving>${gateway.server.receiving}/domibus.war
                                </gateway.deployable.receiving>
                                <gateway.server.dependencies>${gateway.server.dependencies}
                                </gateway.server.dependencies>
                                <domibus.testing.config.file>${domibus.testing.config.file}
                                </domibus.testing.config.file>
                                <gateway.server.sending.configFolder>${gateway.server.sending.configFolder}
                                </gateway.server.sending.configFolder>
                                <gateway.server.receiving.configFolder>${gateway.server.receiving.configFolder}
                                </gateway.server.receiving.configFolder>
                                <database.sending.clean.script>
                                    ${gateway.server.sending.db.clean}
                                </database.sending.clean.script>
                                <database.sending.initial.script>
                                    ${gateway.server.sending.db.initial}
                                </database.sending.initial.script>
                                <database.receiving.initial.script>${gateway.server.receiving.db.initial}
                                </database.receiving.initial.script>
                                <database.receiving.clean.script>${gateway.server.receiving.db.clean}
                                </database.receiving.clean.script>
                                <derby.system.home>${project.build.directory}/derby/databases/</derby.system.home>
                                <!--suppress MavenModelInspection -->
                                <soapui.service.endpoint.sending>
                                    ServiceEndpoint_sending=${domibus.module.ebms3.MSH.host}:${domibus.module.ebms3.MSH.pt}/domibus/services/BackendService/
                                </soapui.service.endpoint.sending>
                                <!--suppress MavenModelInspection -->
                                <soapui.service.endpoint.receiving>
                                    ServiceEndpoint_receiving=${domibus.testing.MSH.host}:${domibus.testing.MSH.pt}/domibus/services/BackendService/
                                </soapui.service.endpoint.receiving>
                                <!--suppress MavenModelInspection -->
                                <soapui.service.endpoint.11.sending>
                                    ServiceEndpoint_1_1_sending=${domibus.module.ebms3.MSH.host}:${domibus.module.ebms3.MSH.pt}/domibus/services/BackendService_1_1/
                                </soapui.service.endpoint.11.sending>
                                <!--suppress MavenModelInspection -->
                                <soapui.service.endpoint.11.receiving>
                                    ServiceEndpoint_1_1_receiving=${domibus.testing.MSH.host}:${domibus.testing.MSH.pt}/domibus/services/BackendService_1_1/
                                </soapui.service.endpoint.11.receiving>
                                <soapui.service.gateway.sending>
                                    GatewayEndpoint_sending=${domibus.module.ebms3.MSH.host}:${domibus.module.ebms3.MSH.pt}/domibus/services/msh/
                                </soapui.service.gateway.sending>
                                <soapui.service.gateway.receiving>
                                    GatewayEndpoint_receiving=${domibus.testing.MSH.host}:${domibus.testing.MSH.pt}/domibus/services/msh/
                                </soapui.service.gateway.receiving>
                            </systemPropertyVariables>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
        </plugins>
    </build>
</project>